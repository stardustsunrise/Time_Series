---
title: "Time Series Project"
author: "Group 1"
date: "2026-01-31"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)

summary(mtcars)

library(dplyr)

```
#Import datasets
```{r}

library(readr)
price_data <- read_csv("3210007701_databaseLoadingData.csv")
head(price_data)
```
```{r}
data2 <- read_csv("3210035101_databaseLoadingData_2.csv")
head(data2)
```

#1.2 Graphical exploration (delivery data)
```{r}
library(ggplot2)

delivery_data = data.frame(Date = data2$REF_DATE,
                           Value = as.numeric(data2$VALUE))

head(delivery_data)
p2 = ggplot(delivery_data, aes(x=Date, y = Value, group=1))+
             geom_line(color="blue", size=1)+
  labs(
    title = "Producer deliveries of Wheat, Excluding Durum",
    subtitle = "2002-2025",
    x = "Date (Monthly)",
    y = "Grain (Tonnes)",
    caption = "Source: Statistics Canada. Table 32-10-0351-01  Producer deliveries of major grains"
  ) 
print(p2)
```
#1.2 Graphical exploration (price data)
```{r}

library(dplyr)
library(ggplot2)
library(lubridate)

price_data <- price_data %>%
  mutate(date = as.Date(paste0(REF_DATE, "-01")))

price_data <- price_data %>%
  group_by(date) %>%
  summarize(
    avg_price_canada = mean(VALUE, na.rm = TRUE)
  ) %>%
  ungroup()

ggplot(price_data, aes(x = date, y = avg_price_canada)) +
  geom_line() +
  labs(
    title = "Monthly Average Prices of Wheat in Canada",
    x = "Month",
    y = "Average Price"
  ) +
  theme_minimal()
print(price_data)

```


#2.1 Removing the Trend (Delivery data)
```{r}
delivery_data_D1 = diff(delivery_data$Value)
delivery_data_D2 = diff(delivery_data_D1)
delivery_data_D3 = diff(log(delivery_data$Value))

par(mfrow=c(2,2))

#Plot Original Graph
plot(delivery_data$Value, type = 'l', xlab = "Date", ylab = "Wheat (Tonnes)", main = "Original Data")
abline(h = 0, col = 'black', lty = 2)

# First-Order Differencing
plot( delivery_data_D1, type = 'l', xlab = 'Date', ylab = "Wheat (Tonnes)", main = "First-order Differencing")
abline(h = 0, col = 'black', lty = 2)

# Second-Order differencing
plot( delivery_data_D2, type = 'l', xlab = 'Date', ylab = "Wheat (Tonnes)", main = "Second-Order Differencing")
abline(h = 0, col = 'black', lty = 2)

# Third-Order differencing
plot( delivery_data_D3, type = 'l', xlab = 'Date', ylab = "Wheat (Tonnes)", main = "Log Differencing")
abline(h = 0, col = 'black', lty = 2)

#Log Differencing is the best option. It does not appear to have a trend.
```

# 2.2 Removing Seasonal Effects (delivery data)
```{r}
library(forecast)

acf(delivery_data_D3, 
    main="ACF of diff series",
    lag.max = 48,
    xlab = "Months",
    xlim=c(1,48)
  )

#There are periodic spikes in the ACF graph at multiples of 12 months, so we will use lag=12 to remove the seasonality.

delivery_data_deseasonalized=diff(delivery_data_D3, lag=12)



plot( delivery_data_deseasonalized, type = 'l', xlab = 'Date', ylab = "Wheat (Tonnes)", main = "Deseasonalized")
abline(h = 0, col = 'black', lty = 2)



```

#2.3 Analysis of differenced Series (delivery data)
```{r}
mean=mean(delivery_data_deseasonalized)
varience = var(delivery_data_deseasonalized)

std_dev = sqrt(varience)

lower = qnorm(mean = mean, sd = std_dev, p=0.05)
upper = qnorm(mean = mean, sd = std_dev, p=0.95)

plot(delivery_data_deseasonalized, type = 'l', main = 'Delivery data, deseasonalized', xlab = 'month', ylab = "Wheat shipped, tonnes")
abline(h = 0, col = 'black', lty = 2)
abline(h = lower, col = 'red', lty = 2)
abline(h = upper, col = 'red', lty = 2)

#Check if 95% is within.
number=0
for(n in 1:length(delivery_data_deseasonalized)){
  if(delivery_data_deseasonalized[n]>upper){
    number=number+1
  }
  if(delivery_data_deseasonalized[n]<lower){
    number=number+1
  }
}
 number
 #26 out of 275 (about 9%) of the values lie outside this range. If the process is stationary, about 5% (13.75) should lie outside this interval on average.
 
 acf(delivery_data_deseasonalized, 
    main="ACF of deseasonalized series",
    lag.max = 48,
    xlab = "Months",
    xlim=c(1,48)
  )
 #Most of the values in the Autocorrelation function are close to 0, which implies that there is no autocorrelation.
 
```


